{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport axios from \"axios\";\nimport { VARIANTS_PRINTFUL } from \"../constants/constants\";\nimport { getLazyDownloader, resetPendingPromise } from \"../Lib/getLazyDownloader\";\nconsole.log(\"useGetInit_init\");\nvar cachedResponse = null;\n\nvar fetchDataPrintful = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(variantIdsArr) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return axios.post(\"api/data-printful\", {\n              variantIdsArr: variantIdsArr\n            });\n\n          case 2:\n            response = _context.sent;\n            return _context.abrupt(\"return\", response);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function fetchDataPrintful(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport function useGetDataPrintful() {\n  _s();\n\n  var _useState = useState(null),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var variantIdsArr = VARIANTS_PRINTFUL.map(function (variant) {\n    return variant.id;\n  });\n\n  var getSetPrice = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var lazyDownloadDataPrintfull, response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n\n              lazyDownloadDataPrintfull = function lazyDownloadDataPrintfull() {\n                return getLazyDownloader(function () {\n                  return cachedResponse;\n                }, function () {\n                  return fetchDataPrintful(variantIdsArr);\n                })();\n              };\n\n              _context2.next = 4;\n              return lazyDownloadDataPrintfull();\n\n            case 4:\n              response = _context2.sent;\n              console.log({\n                FinalRresult_cached: response.data.finalResult\n              });\n              setData(response.data.finalResult);\n              _context2.next = 12;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log({\n                e: _context2.t0\n              });\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function getSetPrice() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    // console.log(\n    //   { keys: Object.keys(data), variantIdsArr },\n    //   JSON.stringify(Object.keys(data)) == JSON.stringify(variantIdsArr),\n    //   { idsAlreadyFetched: idsAlreadyFetched(variantIdsArr) }\n    // );\n    // if (!data) {\n    //   getSetPrice();\n    // }\n    console.log(\"useGetDataPrintful_fetch_new_prices\", variantIdsArr);\n    getSetPrice();\n  }, [JSON.stringify(variantIdsArr)]);\n  var data_memo = useMemo(function () {\n    return data;\n  }, [data]);\n  return {\n    data: data_memo\n  };\n}\n\n_s(useGetDataPrintful, \"A8mo85klPhbvUEwI3TsfIY2DjV4=\");","map":{"version":3,"sources":["/Users/petrhoskovec/Desktop/code/trip_map_staging/src/Hooks/useGetDataPrintful.js"],"names":["useState","useEffect","useMemo","axios","VARIANTS_PRINTFUL","getLazyDownloader","resetPendingPromise","console","log","cachedResponse","fetchDataPrintful","variantIdsArr","post","response","useGetDataPrintful","data","setData","map","variant","id","getSetPrice","lazyDownloadDataPrintfull","FinalRresult_cached","finalResult","e","JSON","stringify","data_memo"],"mappings":";;;;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,EAA8BC,OAA9B,QAA6C,OAA7C;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,iBAAT,QAAkC,wBAAlC;AACA,SACEC,iBADF,EAEEC,mBAFF,QAGO,0BAHP;AAKAC,OAAO,CAACC,GAAR,CAAY,iBAAZ;AAEA,IAAIC,cAAc,GAAG,IAArB;;AAEA,IAAMC,iBAAiB;AAAA,sEAAG,iBAAOC,aAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACDR,KAAK,CAACS,IAAN,sBAAgC;AAAED,cAAAA,aAAa,EAAbA;AAAF,aAAhC,CADC;;AAAA;AAClBE,YAAAA,QADkB;AAAA,6CAEjBA,QAFiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAjBH,iBAAiB;AAAA;AAAA;AAAA,GAAvB;;AAKA,OAAO,SAASI,kBAAT,GAA8B;AAAA;;AAAA,kBACXd,QAAQ,CAAC,IAAD,CADG;AAAA,MAC5Be,IAD4B;AAAA,MACtBC,OADsB;;AAGnC,MAAML,aAAa,GAAGP,iBAAiB,CAACa,GAAlB,CAAsB,UAACC,OAAD;AAAA,WAAaA,OAAO,CAACC,EAArB;AAAA,GAAtB,CAAtB;;AAEA,MAAMC,WAAW;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEVC,cAAAA,yBAFU,GAEkB,SAA5BA,yBAA4B,GAAM;AACtC,uBAAOhB,iBAAiB,CACtB;AAAA,yBAAMI,cAAN;AAAA,iBADsB,EAEtB;AAAA,yBAAMC,iBAAiB,CAACC,aAAD,CAAvB;AAAA,iBAFsB,CAAjB,EAAP;AAID,eAPe;;AAAA;AAAA,qBAQOU,yBAAyB,EARhC;;AAAA;AAQVR,cAAAA,QARU;AAUhBN,cAAAA,OAAO,CAACC,GAAR,CAAY;AAAEc,gBAAAA,mBAAmB,EAAET,QAAQ,CAACE,IAAT,CAAcQ;AAArC,eAAZ;AAEAP,cAAAA,OAAO,CAACH,QAAQ,CAACE,IAAT,CAAcQ,WAAf,CAAP;AAZgB;AAAA;;AAAA;AAAA;AAAA;AAchBhB,cAAAA,OAAO,CAACC,GAAR,CAAY;AAAEgB,gBAAAA,CAAC;AAAH,eAAZ;;AAdgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAXJ,WAAW;AAAA;AAAA;AAAA,KAAjB;;AAkBAnB,EAAAA,SAAS,CAAC,YAAM;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ,EAAmDG,aAAnD;AACAS,IAAAA,WAAW;AACZ,GAXQ,EAWN,CAACK,IAAI,CAACC,SAAL,CAAef,aAAf,CAAD,CAXM,CAAT;AAaA,MAAMgB,SAAS,GAAGzB,OAAO,CAAC,YAAM;AAC9B,WAAOa,IAAP;AACD,GAFwB,EAEtB,CAACA,IAAD,CAFsB,CAAzB;AAIA,SAAO;AAAEA,IAAAA,IAAI,EAAEY;AAAR,GAAP;AACD;;GAzCeb,kB","sourcesContent":["import { useState, useEffect, useMemo } from \"react\";\nimport axios from \"axios\";\nimport { VARIANTS_PRINTFUL } from \"../constants/constants\";\nimport {\n  getLazyDownloader,\n  resetPendingPromise,\n} from \"../Lib/getLazyDownloader\";\n\nconsole.log(\"useGetInit_init\");\n\nlet cachedResponse = null;\n\nconst fetchDataPrintful = async (variantIdsArr) => {\n  const response = await axios.post(`api/data-printful`, { variantIdsArr });\n  return response;\n};\n\nexport function useGetDataPrintful() {\n  const [data, setData] = useState(null);\n\n  const variantIdsArr = VARIANTS_PRINTFUL.map((variant) => variant.id);\n\n  const getSetPrice = async () => {\n    try {\n      const lazyDownloadDataPrintfull = () => {\n        return getLazyDownloader(\n          () => cachedResponse,\n          () => fetchDataPrintful(variantIdsArr)\n        )();\n      };\n      const response = await lazyDownloadDataPrintfull();\n\n      console.log({ FinalRresult_cached: response.data.finalResult });\n\n      setData(response.data.finalResult);\n    } catch (e) {\n      console.log({ e });\n    }\n  };\n\n  useEffect(() => {\n    // console.log(\n    //   { keys: Object.keys(data), variantIdsArr },\n    //   JSON.stringify(Object.keys(data)) == JSON.stringify(variantIdsArr),\n    //   { idsAlreadyFetched: idsAlreadyFetched(variantIdsArr) }\n    // );\n    // if (!data) {\n    //   getSetPrice();\n    // }\n    console.log(\"useGetDataPrintful_fetch_new_prices\", variantIdsArr);\n    getSetPrice();\n  }, [JSON.stringify(variantIdsArr)]);\n\n  const data_memo = useMemo(() => {\n    return data;\n  }, [data]);\n\n  return { data: data_memo };\n}\n"]},"metadata":{},"sourceType":"module"}